<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FITI AT">
    
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/4345/4345638.png">
    <link rel="manifest" href="manifest.json">

    <title>FITI ‚Äì Inspecci√≥n AT</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

<!-- ===== CABECERA ANEXO ITI (COM√öN A TODA LA APP) ===== -->
<div id="cabecera-anexo" class="cabecera-anexo">
    <div>
        <strong>ANEXO 1 ‚Äì ITI-AT-001</strong><br>
        FITI-AT-001/01 REV3
    </div>
    <div id="paginado-anexo">
        P√°gina <span id="pagina-actual">1</span> de <span id="pagina-total">10</span>
    </div>
</div>

<div class="container">

    <!-- ================= HOJA 1 ================= -->
    <div id="hoja1" class="page">
        <h1 class="main-title">Registro de Inspecci√≥n</h1>
        <p class="step-subtitle">Fase 1: Preparaci√≥n y Geolocalizaci√≥n</p>

        <div class="card">
            <label class="label-bold">Nombre del Inspector *</label>
            <input id="inspector" class="input-modern">

            <label class="label-bold" style="margin-top:10px;">N¬∫ Expediente *</label>
            <input id="expediente" class="input-modern">
        </div>

        <div class="card">
            <label class="label-bold">Equipos de Medida</label>
            <div class="input-grupal">
                <input id="eq-referencia" class="input-modern">
                <button type="button" onclick="a√±adirEquipoMedida()">+</button>
            </div>
            <ul id="lista-equipos"></ul>
        </div>

        <div class="card">
            <label class="label-bold">Firma del T√©cnico</label>
            <div class="signature-wrapper">
                <canvas id="canvas-firma"></canvas>
            </div>
            <button type="button" class="btn-clear" onclick="limpiarFirma()">‚úñ Borrar Firma</button>
        </div>

        <button class="btn-gps-action" onclick="iniciarInspeccion()">üöÄ CAPTURAR GPS E INICIAR</button>

        <div id="datos-inicio" style="display:none;">
            <p>üìç GPS: <span id="gps-display"></span></p>
            <!-- üîß ANTES iba a hoja2 (DOCUMENTACI√ìN) -->
            <!-- ‚úÖ AHORA va directo a DATOS DEL TRAFO -->
            <button class="btn-continue" onclick="cambiarHoja(2)">CONTINUAR ‚Üí</button>
        </div>
    </div>

<!-- ================= HOJA 2 ‚Äì DATOS TITULAR E INSTALACI√ìN ================= -->
<div id="hoja2" class="page" style="display:none;">
    <h1>Datos del Titular e Instalaci√≥n</h1>

    <!-- ===== TITULAR ===== -->
    <div class="card">
        <p class="section-tag">Titular</p>

        <label class="mini-label">Nombre / Raz√≥n social</label>
        <input id="titular_nombre" class="input-modern">

        <div class="grid-tecnico">
            <div>
                <label class="mini-label">CIF</label>
                <input id="titular_cif" class="input-modern">
            </div>
            <div>
                <label class="mini-label">Tel√©fono</label>
                <input id="titular_telefono" class="input-modern">
            </div>
        </div>

        <label class="mini-label">Direcci√≥n</label>
        <input id="titular_direccion" class="input-modern">

        <div class="grid-tecnico">
            <div>
                <label class="mini-label">CP / Localidad</label>
                <input id="titular_cp" class="input-modern">
            </div>
            <div>
                <label class="mini-label">Provincia</label>
                <input id="titular_provincia" class="input-modern">
            </div>
        </div>
    </div>

    <!-- ===== INSTALACI√ìN ===== -->
    <div class="card">
        <p class="section-tag">Instalaci√≥n</p>

        <label class="mini-label">Denominaci√≥n de la instalaci√≥n</label>
        <input id="inst_denominacion" class="input-modern">

        <label class="mini-label">Ubicaci√≥n (coordenadas)</label>
        <input id="inst_coordenadas" class="input-modern">

        <label class="mini-label">Direcci√≥n</label>
        <input id="inst_direccion" class="input-modern">

        <div class="grid-tecnico">
            <div>
                <label class="mini-label">CP / Localidad</label>
                <input id="inst_cp" class="input-modern">
            </div>
            <div>
                <label class="mini-label">Provincia</label>
                <input id="inst_provincia" class="input-modern">
            </div>
        </div>

        <div class="grid-tecnico">
            <div>
                <label class="mini-label">N¬∫ Registro</label>
                <input id="inst_registro" class="input-modern">
            </div>
            <div>
                <label class="mini-label">Fecha √∫ltima inspecci√≥n</label>
                <input id="inst_ultima" class="input-modern">
            </div>
            <div>
                <label class="mini-label">Reglamento</label><br>
                <label><input type="radio" name="inst_reglamento" value="1982"> 1982</label>
                <label><input type="radio" name="inst_reglamento" value="2014"> 2014</label>
            </div>
        </div>
    </div>

    <!-- ===== TIPO DE INSPECCI√ìN ===== -->
    <div class="card">
        <p class="section-tag">Tipo de inspecci√≥n</p>

        <div class="grid-tecnico">
            <label>
                <input type="radio" name="insp_tipo_principal" value="Inicial"
                       onchange="toggleInicial(true)">
                Inicial
            </label>
            <label>
                <input type="radio" name="insp_tipo_principal" value="Periodica"
                       onchange="toggleInicial(false)">
                Peri√≥dica
            </label>
        </div>

        <!-- SOLO SI ES INICIAL -->
        <div id="bloque_inicial"
             style="display:none; margin-top:12px; padding-left:10px; border-left:3px solid #3b82f6;">

            <label><input type="checkbox" id="insp_nueva"> Nueva</label>

            <div class="grid-tecnico" style="margin-top:6px;">
                <label>
                    <input type="checkbox" id="insp_ampliacion"
                           onchange="document.getElementById('kw_ampliacion').style.display=this.checked?'block':'none'">
                    Ampliaci√≥n
                </label>
                <input id="kw_ampliacion" class="input-mini" placeholder="kW ampliados"
                       style="display:none;">
            </div>

            <div class="grid-tecnico" style="margin-top:6px;">
                <label>
                    <input type="checkbox" id="insp_modificacion"
                           onchange="document.getElementById('kw_modificacion').style.display=this.checked?'block':'none'">
                    Modificaci√≥n
                </label>
                <input id="kw_modificacion" class="input-mini" placeholder="kW modificados"
                       style="display:none;">
            </div>
        </div>
    </div>

    <!-- ===== PROYECTISTA ===== -->
    <div class="card">
        <p class="section-tag">Proyectista (solo inspecciones iniciales)</p>

        <div class="grid-tecnico">
            <input class="input-modern" placeholder="Nombre">
            <input class="input-modern" placeholder="Apellidos">
        </div>

        <div class="grid-tecnico">
            <input class="input-modern" placeholder="Colegio">
            <input class="input-modern" placeholder="N¬∫ colegiado">
        </div>
    </div>

    <!-- ===== DIRECTOR DE OBRA ===== -->
    <div class="card">
        <p class="section-tag">Director de obra (solo inspecciones iniciales)</p>

        <div class="grid-tecnico">
            <input class="input-modern" placeholder="Nombre">
            <input class="input-modern" placeholder="Apellidos">
        </div>

        <div class="grid-tecnico">
            <input class="input-modern" placeholder="Colegio">
            <input class="input-modern" placeholder="N¬∫ colegiado">
        </div>
    </div>

    <!-- ===== INSTALADOR / MANTENEDOR ===== -->
    <div class="card">
        <p class="section-tag">Instalador / Mantenedor</p>

        <div class="grid-tecnico">
            <input class="input-modern" placeholder="Empresa">
            <input class="input-modern" placeholder="CIF / NIF">
        </div>

        <input class="input-modern" placeholder="Nombre responsable">
    </div>

    <!-- ===== DATOS T√âCNICOS ===== -->
    <div class="card">
        <p class="section-tag">Datos t√©cnicos de la instalaci√≥n</p>

        <div class="fila-dato">
            <span class="etiqueta">Tipo de instalaci√≥n</span>
            <label><input type="radio" name="tipo_inst" value="Interior"> Interior</label>
            <label><input type="radio" name="tipo_inst" value="Exterior"> Exterior</label>
        </div>

        <div class="fila-dato">
            <span class="etiqueta">L√≠nea de alimentaci√≥n</span>
            <label><input type="radio" name="linea_alim" value="Aerea"> A√©rea</label>
            <label><input type="radio" name="linea_alim" value="Subterranea"> Subterr√°nea</label>
            <label><input type="radio" name="linea_alim" value="Mixta"> Mixta</label>
        </div>

        <div class="fila-dato">
            <span class="etiqueta">Protecci√≥n sobretensiones</span>
            <label><input type="radio" name="sobretensiones" value="Si"> S√≠</label>
            <label><input type="radio" name="sobretensiones" value="No"> No</label>
        </div>

            <label class="mini-label">Tensiones de servicio 1¬∫ / 2¬∫ (V)</label>
            <input id="inst_tensiones" class="input-modern">

            <label class="mini-label">Potencia instalada total (kVA)</label>
            <input id="inst_potencia_total" class="input-modern">

            <label class="mini-label">Empresa de distribuci√≥n</label>
            <input id="inst_empresa_distribuidora" class="input-modern">

    </div>

    <!-- ===== NAVEGACI√ìN ===== -->
    <div class="footer-nav">
        <button class="btn-back" onclick="cambiarHoja(1)">‚Üê Volver</button>
        <button class="btn-continue" onclick="cambiarHoja(3)">DATOS TRAFO ‚Üí</button>
    </div>

</div>

    <!-- ================= HOJA 3 ================= -->
    <div id="hoja3" class="page" style="display:none;">
        <h1>2. CARACTER√çSTICAS DEL TRAFO</h1>
        <div id="contenedor-trafos-datos"></div>

        <button class="btn-add-trafo" onclick="a√±adirFormularioTrafo()">+ A√ëADIR TRANSFORMADOR</button>

        <div class="footer-nav">
            <!-- üîß ANTES volv√≠a a hoja2 -->
            <button class="btn-back" onclick="cambiarHoja(1)">‚Üê Volver</button>
            <button class="btn-continue" onclick="cambiarHoja(4)">CHECKLIST ‚Üí</button>
        </div>
    </div>

    <!-- ================= HOJA 4 ================= -->
    <div id="hoja4" class="page" style="display:none;">
        <h1 id="titulo-seccion"></h1>
        <div id="contenedor-preguntas"></div>

        <div class="footer-nav">
            <button class="btn-back" onclick="irAtras()">‚Üê Volver</button>
            <button class="btn-continue" id="btn-siguiente-seccion" onclick="irAdelante()">SIGUIENTE ‚Üí</button>
        </div>
    </div>

<!-- ================= ANEXO 1 ‚Äì P√ÅGINA 6 ================= -->
<div class="anexo-pagina" id="pagina6-tierras" style="display:none;">

    <div class="anexo-header">
        <strong>ANEXO 1 ‚Äì ITI-AT-001</strong><br>
        FITI-AT-001/01 REV3<br>
        P√°gina 6 de 10
    </div>

    <h3>Medici√≥n de la instalaci√≥n de puesta a tierra</h3>

    <div class="card">
        <label class="mini-label">Estado del terreno</label>
        <input id="estado_terreno" class="input-modern">
    </div>

    <div class="card">
        <table class="tabla-tierras">
            <tr>
                <th>Punto</th>
                <th>Identificaci√≥n</th>
                <th>Valor (Œ©)</th>
            </tr>
            <tr>
                <td>1</td>
                <td><input id="tierra_1" class="input-mini"></td>
                <td><input id="valor_t1" class="input-mini"></td>
            </tr>
            <tr>
                <td>2</td>
                <td><input id="tierra_2" class="input-mini"></td>
                <td><input id="valor_t2" class="input-mini"></td>
            </tr>
            <tr>
                <td>3</td>
                <td><input id="tierra_3" class="input-mini"></td>
                <td><input id="valor_t3" class="input-mini"></td>
            </tr>
            <tr>
                <td>4</td>
                <td><input id="tierra_4" class="input-mini"></td>
                <td><input id="valor_t4" class="input-mini"></td>
            </tr>
        </table>
    </div>

    <div class="card">
        <label class="mini-label">Foto de la medici√≥n</label>
        <input type="file"
               id="foto_tierras"
               accept="image/*"
               capture="environment">
        <img id="preview_foto_tierras"
             style="display:none;max-width:100%;margin-top:8px;">
    </div>

</div>


<!-- ================= HOJA CERTIFICADO ================= -->
<div id="hojaCertificado" class="page" style="display:none;">
    <h1>Certificado de Inspecci√≥n AT</h1>

    <!-- ===== CABECERA ===== -->
    <div class="card">
        <p class="section-tag">Cabecera</p>

        <label class="mini-label">N¬∫ Expediente</label>
        <input id="cert_expediente" class="input-modern" readonly>

        <label class="mini-label">Fecha inspecci√≥n</label>
        <input id="cert_fecha" class="input-modern" readonly>
    </div>

    <!-- ===== TITULAR ===== -->
    <div class="card">
        <p class="section-tag">Titular</p>

        <input id="cert_titular_nombre" class="input-modern" placeholder="Nombre" readonly>
        <input id="cert_titular_cif" class="input-modern" placeholder="CIF" readonly>
        <input id="cert_titular_telefono" class="input-modern" placeholder="Tel√©fono" readonly>
        <input id="cert_titular_direccion" class="input-modern" placeholder="Direcci√≥n" readonly>
        <input id="cert_titular_cp" class="input-modern" placeholder="CP / Localidad" readonly>
        <input id="cert_titular_provincia" class="input-modern" placeholder="Provincia" readonly>
    </div>

    <!-- ===== INSTALACI√ìN ===== -->
    <div class="card">
        <p class="section-tag">Instalaci√≥n</p>

        <input id="cert_inst_denominacion" class="input-modern" placeholder="Denominaci√≥n" readonly>
        <input id="cert_inst_direccion" class="input-modern" placeholder="Direcci√≥n" readonly>
        <input id="cert_inst_cp" class="input-modern" placeholder="CP / Localidad" readonly>
        <input id="cert_inst_provincia" class="input-modern" placeholder="Provincia" readonly>
        <input id="cert_inst_registro" class="input-modern" placeholder="N¬∫ Registro" readonly>
        <input id="cert_inst_reglamento" class="input-modern" placeholder="Reglamento" readonly>
    </div>

    <!-- ===== TIPO DE INSPECCI√ìN ===== -->
    <div class="card">
        <p class="section-tag">Tipo de inspecci√≥n</p>

        <input id="cert_tipo_inspeccion" class="input-modern" readonly>
        <input id="cert_subtipo_inspeccion" class="input-modern" readonly>
    </div>

    <!-- ===== T√âCNICOS ===== -->
    <div class="card">
        <p class="section-tag">T√©cnicos</p>

        <input id="cert_proyectista" class="input-modern" placeholder="Proyectista" readonly>
        <input id="cert_director" class="input-modern" placeholder="Director de obra" readonly>
        <input id="cert_instalador" class="input-modern" placeholder="Instalador / Mantenedor" readonly>
    </div>

    <!-- ===== DATOS T√âCNICOS ===== -->
    <div class="card">
        <p class="section-tag">Datos t√©cnicos</p>

        <input id="cert_tipo_instalacion" class="input-modern" readonly>
        <input id="cert_linea_alimentacion" class="input-modern" readonly>
        <input id="cert_sobretensiones" class="input-modern" readonly>
        <input id="cert_tensiones" class="input-modern" readonly>
        <input id="cert_potencia_total" class="input-modern" readonly>
        <input id="cert_empresa_distribuidora" class="input-modern" readonly>
    </div>

    <!-- ===== RESULTADO ===== -->
    <div class="card">
        <p class="section-tag">Resultado de la inspecci√≥n</p>

        <textarea id="cert_resultado" class="input-modern" rows="4" readonly></textarea>
    </div>

    <div class="footer-nav">
        <button class="btn-back" onclick="cambiarHoja(4)">‚Üê Volver</button>     
        <button class="btn-continue" onclick="exportarCertificadoPDF()">
        EXPORTAR PDF
        </button>

    </div>
</div>

</div>
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<script src="app.js"></script>
</body>
</html>

